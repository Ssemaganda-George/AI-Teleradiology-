<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>AI Teleradiology Agent | Uganda AI Fest 2026</title>
        <script src="https://cdn.tailwindcss.com"></script>
        <style>
            /* small local helpers */
            .priority-blink { animation: blink 1.4s infinite; }
            @keyframes blink { 0% { opacity: 1 } 50% { opacity: 0.5 } 100% { opacity: 1 } }
        </style>
    </head>
    <body class="bg-gray-50 text-gray-800 antialiased">
        <!-- Header -->
        <header class="bg-white border-b">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                <div class="flex items-center justify-between h-16">
                    <div class="flex items-center gap-3">
                        <!-- simple inline SVG logo -->
                        <svg class="h-8 w-8 text-blue-600" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
                            <circle cx="9" cy="9" r="7" stroke="currentColor" stroke-width="1.5"/>
                            <path d="M14 14l6 6" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
                        </svg>
                        <h1 class="text-lg font-semibold">AI Teleradiology Agent</h1>
                        <span class="ml-2 text-sm text-gray-500">Uganda AI Fest 2026</span>
                    </div>
                    <div id="network-status" class="text-sm text-gray-600 flex items-center gap-2" aria-live="polite">
                        <svg id="network-dot" class="h-3 w-3 text-emerald-500" viewBox="0 0 8 8" fill="currentColor"><circle cx="4" cy="4" r="4"/></svg>
                        <span>System Online (Uganda Node)</span>
                    </div>
                </div>
            </div>
        </header>

        <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                <!-- Left column: upload + stats -->
                <section class="lg:col-span-1 space-y-6">
                    <div class="bg-white p-6 rounded-lg shadow-sm border">
                        <h2 class="text-lg font-medium mb-3">Upload New Scan</h2>
                        <div id="drop-zone" class="flex flex-col items-center justify-center gap-3 p-6 border-2 border-dashed rounded-lg cursor-pointer hover:border-blue-300 focus:outline-none focus:ring-2 focus:ring-blue-300" role="button" tabindex="0">
                            <svg class="h-10 w-10 text-blue-500" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true"><path d="M16 16l4-4-4-4" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/><path d="M8 16V8c0-1.1.9-2 2-2h4" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/></svg>
                            <p class="text-sm text-gray-600">Drag & drop DICOM (.dcm) files here, or click to browse</p>
                            <input id="file-input" type="file" accept=".dcm" class="sr-only" />
                        </div>

                        <div class="mt-4 grid grid-cols-1 gap-3">
                            <button id="simulate-btn" class="w-full inline-flex items-center justify-center gap-2 rounded-md bg-orange-100 text-orange-700 px-4 py-2 text-sm hover:bg-orange-200">
                                <svg class="h-4 w-4" viewBox="0 0 24 24" fill="none"><path d="M12 2v6" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/><path d="M12 16v6" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/></svg>
                                Simulate Network Disruption
                            </button>
                        </div>
                    </div>

                    <div class="bg-white p-6 rounded-lg shadow-sm border">
                        <h3 class="text-sm font-semibold text-gray-700 mb-2">Agent Reasoning Stats</h3>
                        <dl class="grid grid-cols-1 gap-2 text-sm text-gray-700">
                            <div class="flex justify-between"><span>Avg. Turnaround</span><span class="font-medium">14.4 Hours</span></div>
                            <div class="flex justify-between"><span>Accuracy Gain</span><span class="font-medium">+25%</span></div>
                            <div class="flex justify-between"><span>Resilience</span><span class="font-medium">Auto-Sync</span></div>
                        </dl>
                    </div>
                </section>

                <!-- Right column: worklist -->
                <section class="lg:col-span-2">
                    <div class="bg-white rounded-lg shadow-sm border overflow-hidden">
                        <div class="px-6 py-4 border-b flex items-center justify-between">
                            <h2 class="text-md font-semibold">Radiologist Worklist</h2>
                            <span class="inline-flex items-center bg-blue-600 text-white text-xs rounded-full px-2 py-1">Live</span>
                        </div>

                        <div class="p-4 overflow-x-auto">
                            <table class="w-full text-left">
                                <thead class="text-xs text-gray-500 uppercase">
                                    <tr>
                                        <th class="px-4 py-2">Status</th>
                                        <th class="px-4 py-2">Patient ID</th>
                                        <th class="px-4 py-2">AI Finding</th>
                                        <th class="px-4 py-2">Confidence</th>
                                        <th class="px-4 py-2">Action</th>
                                    </tr>
                                </thead>
                                <tbody id="worklist-body" class="text-sm">
                                    <tr class="border-t">
                                        <td class="px-4 py-3"><span class="px-2 py-1 bg-gray-100 text-gray-700 rounded text-xs">Routine</span></td>
                                        <td class="px-4 py-3 font-medium">UG-7721</td>
                                        <td class="px-4 py-3 text-gray-600">Normal Scan</td>
                                        <td class="px-4 py-3">98.2%</td>
                                        <td class="px-4 py-3"><button class="text-blue-600 hover:underline text-sm">View</button></td>
                                    </tr>
                                </tbody>
                            </table>

                            <div id="loading-spinner" class="hidden mt-6 text-center text-sm text-gray-500">
                                <svg class="mx-auto h-6 w-6 animate-spin text-blue-600" viewBox="0 0 24 24" fill="none"><circle cx="12" cy="12" r="10" stroke="currentColor" stroke-opacity="0.25" stroke-width="4"/><path d="M22 12a10 10 0 00-10-10" stroke="currentColor" stroke-width="4" stroke-linecap="round"/></svg>
                                <p class="mt-2">AI Agent is reasoning about the image...</p>
                            </div>
                        </div>
                    </div>
                </section>
            </div>
        </main>

        <script>
            // Config: placeholder. For production, replace or fetch from /config.json
            const API_URL = 'YOUR_NGROK_API_URL';

            const worklistBody = document.getElementById('worklist-body');
            const fileInput = document.getElementById('file-input');
            const dropZone = document.getElementById('drop-zone');
            const spinner = document.getElementById('loading-spinner');
            const networkStatus = document.getElementById('network-status');
            const networkDot = document.getElementById('network-dot');
            const simulateBtn = document.getElementById('simulate-btn');

            let isOnline = true;

            // Accessibility: open file dialog on click or Enter/Space
            dropZone.addEventListener('click', () => fileInput.click());
            dropZone.addEventListener('keydown', (e) => { if (e.key === 'Enter' || e.key === ' ') { e.preventDefault(); fileInput.click(); } });

            // Basic drag & drop handlers
            dropZone.addEventListener('dragover', (e) => { e.preventDefault(); dropZone.classList.add('border-blue-300'); });
            dropZone.addEventListener('dragleave', () => dropZone.classList.remove('border-blue-300'));
            dropZone.addEventListener('drop', (e) => {
                e.preventDefault(); dropZone.classList.remove('border-blue-300');
                const file = e.dataTransfer.files[0];
                if (file) handleUpload(file);
            });

            fileInput.addEventListener('change', (e) => handleUpload(e.target.files[0]));

            async function handleUpload(file) {
                if (!file) return;
                if (!isOnline) {
                    alert('Network Disrupted â€” file queued for later sync.');
                    addToWorklist({ diagnosis: 'Queued (Offline)', confidence: 'N/A', status: 'Offline' }, 'UG-NEW');
                    return;
                }

                spinner.classList.remove('hidden');

                const formData = new FormData();
                formData.append('file', file);

                try {
                    const res = await fetch(`${API_URL}/analyze`, { method: 'POST', body: formData });
                    const data = await res.json();
                    addToWorklist(data, 'UG-' + Math.floor(Math.random() * 9000 + 1000));
                } catch (err) {
                    console.error(err);
                    alert('Unable to reach AI Agent. Check your backend endpoint.');
                } finally {
                    spinner.classList.add('hidden');
                    fileInput.value = '';
                }
            }

            function addToWorklist(data, patientId) {
                const isPriority = data.status === 'Priority';
                const tr = document.createElement('tr');
                tr.className = 'border-t';

                tr.innerHTML = `
                    <td class="px-4 py-3"><span class="px-2 py-1 rounded text-xs font-semibold ${isPriority ? 'bg-red-600 text-white priority-blink' : 'bg-gray-100 text-gray-700'}">${data.status}</span></td>
                    <td class="px-4 py-3 font-medium">${patientId}</td>
                    <td class="px-4 py-3 text-gray-700 font-medium">${data.diagnosis}</td>
                    <td class="px-4 py-3">${data.confidence}%</td>
                    <td class="px-4 py-3"><button class="bg-blue-600 text-white px-3 py-1 rounded text-sm hover:bg-blue-700">Review</button></td>
                `;

                if (isPriority) worklistBody.prepend(tr); else worklistBody.appendChild(tr);
            }

            function updateNetworkUI() {
                if (isOnline) {
                    networkDot.classList.remove('text-red-500'); networkDot.classList.add('text-emerald-500');
                    networkStatus.querySelector('span')?.remove();
                    networkStatus.insertAdjacentHTML('beforeend', '<span>System Online (Uganda Node)</span>');
                } else {
                    networkDot.classList.remove('text-emerald-500'); networkDot.classList.add('text-red-500');
                    networkStatus.querySelector('span')?.remove();
                    networkStatus.insertAdjacentHTML('beforeend', '<span>Network Disrupted</span>');
                }
            }

            simulateBtn.addEventListener('click', () => {
                isOnline = !isOnline; updateNetworkUI();
                alert(isOnline ? 'Connectivity Restored. Agent synchronizing.' : 'Connectivity Lost. Offline mode enabled.');
            });
        </script>
    </body>
</html>
